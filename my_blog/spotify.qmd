---
title: Understanding Spotify User Behavior
subtitle: '*Manipulating and Visualizing User Patterns with Polars*'
author: Jesus L. Monroy
date: last-modified
date-format: MMM, YYYY
abstract: |
  This project explores a dataset of Spotify music listening habits, leveraging the power of the Polars DataFrame library for efficient and scalable analysis. By employing Polars' optimized data manipulation capabilities, we efficiently process and analyze Spotify data, extracting meaningful insights into user behavior and the dynamics of the music ecosystem. Furthermore, this work highlights the potential of Polars as a powerful tool for large-scale data analysis in the music industry and beyond.
toc: true
toc-depth: 3
toc-expand: 3
toc-title: Table of Contents
number-sections: false
execute:
  echo: true
format:
  html:
    self-contained: true
    grid:
      sidebar-width: 200px
      body-width: 950px
      margin-width: 150px
    reference-location: margin
    fig-cap-location: margin
    cap-location: margin
    tbl-cap-location: margin
    other-links:
      - text: Medium
        icon: medium
        href: https://medium.com/@jesuslm
      - text: Linkedin
        icon: linkedin
        href: https://www.linkedin.com/in/j3sus-lm
      - text: Twitter
        icon: twitter
        href: https://x.com/j3suslm
    code-fold: show
    code-summary: Show code
    code-tools:
      source: false
      toggle: true
      caption: code
    html-math-method: mathml
code-line-numbers: false
code-copy: false
code-overflow: wrap
jupyter: python3
---


::: {#fig-people}

![](images/spotify.png){width=100% .lightbox}

Spotify, a leading digital music, podcast, and video streaming service, has revolutionized the way individuals consume audio content.
By offering a vast library of on-demand content through a freemium model, Spotify has significantly shifted music consumption from ownership to access.
Spotify's expansion into podcasting and other audio content reflects its ambition to become a comprehensive audio platform.
:::

# Overview

This study conducts a historical analysis of Spotify data, leveraging the efficiency of `Polars`, the analytical power of `DuckDB`, and the visualization capabilities of `Plotly`.
By combining these tools, we examine trends in music consumption, artist popularity, and playlist dynamics over time.

Polars facilitates rapid data manipulation and cleaning of large Spotify datasets, while `DuckDB` enables complex `SQL` queries for in-depth analysis.

`Plotly` is then employed to create interactive visualizations, revealing patterns and insights that would be difficult to discern from raw data alone.

This analysis explores the evolution of musical genres, the impact of algorithmic recommendations, and the shifting landscape of artist distribution.

We demonstrate the efficacy of this toolchain for extracting meaningful narratives from Spotify's extensive historical data, providing a comprehensive understanding of the platform's influence on the music industry.

# Environment settings

```{python}
# import libraries
import numpy as np
import pandas as pd
import polars as pl
import duckdb as db
import os
from dotenv import load_dotenv
load_dotenv('.env')
import plotly.express as px
from great_tables import GT, md
```

## Database connection

[`Duckdb` is a powerful tool for data analysts and developers who need to perform fast and efficient analytical queries on large datasets, especially in environments where simplicity and portability are crucial.]{.aside}

```{python}
#| output: false

# database connection
token = os.getenv('MD_TOKEN')
conn = db.connect(f"md:?motherduck_token={token}")
# create dataframe
df = conn.sql('select * from projects.spotify_history').pl()
conn.close()
```

[`Polars` is a modern DataFrame library designed for speed and efficiency, offering a compelling alternative to traditional data manipulation tools.]{.aside}

# Dataset

```{python}
df.schema
```

```{python}
df = (
    df.select(pl.exclude('spotify_track_uri'))
        .with_columns(year=pl.col('ts').dt.year())
)
```

```{python}
#| label: tbl-overview
#| tbl-cap: Preview of the dataset, showing the columns and a sample of data used in the analysis.

(
    GT(df.head())
    .tab_header(title=md("### Spotify Songs History Dataset"))
    .fmt_date(columns='ts', date_style='iso')
    .fmt_number(columns='ms_played', decimals=0)
    .cols_hide(columns='year')
    .cols_label(
        ts='Date',
        platform='Platform',
        ms_played='Mins played',
        track_name='Song',
        artist_name='Artist',
        album_name='Album',
        reason_start='Reason start',
        reason_end='Reason end',
        shuffle='Shuffle',
        skipped='Skipped',
    )
    .tab_options(table_font_size='90%')
    .tab_options(table_width='90%')
    .tab_source_note(source_note='Source: https://mavenanalytics.io')
)
```

```{python}
print(f'The data set has {df.shape[0]:,.0f} rows.')
print(f'The dataset goes from {df['year'].min()} up to {df['year'].max()}.')
```

::: {.column-margin}
For further information about the fields of the dataset see @tbl-dictionary
:::

# Unique Artists, Albums and Songs

```{python}
# unique values per year
tops = (
        df.select('year','artist_name','album_name','track_name')
            .group_by('year', maintain_order=True)
            .n_unique()
)
```

```{python}
#| label: tbl-tops
#| tbl-cap: Unique Artists, Albums and Songs by Year.

(
    GT(tops)
    .tab_header(title=md("### Unique Artists, Albums and Songs Played by Year"))
    .fmt_number(columns=['artist_name','album_name','track_name'], decimals=0)
    .cols_label(
        year='Year',
        artist_name='Artists',
        album_name='Albums',
        track_name='Songs',
    )
    .tab_options(table_font_size='90%')
    .tab_options(table_width='90%')
    .tab_source_note(source_note='Source: Self-elaboration by author')
)
```

# Minutes Played by Month and Year

```{python}
years = (
    df.group_by('year', maintain_order=True)
        .agg((pl.col('ms_played').sum()/60_000).round(2).alias('total_mins'))
)
```

```{python}
months = (
    df.group_by_dynamic('ts', every='1mo')
        .agg((pl.col('ms_played').sum()/60_000).round(2)
        .alias('total_mins'))
)
```

```{python}
#| label: fig-minutes-year
#| fig-cap: Total of Minutes Played By Year.

fig = px.line(years, x='year', y='total_mins',)

fig.update_layout(
    title=dict(text='Spotify Played Minutes by Year', font=dict(size=30), yref='paper'),
    template='ggplot2',
    autosize=False,
    width=830,
    height=500,
    showlegend=True,
    plot_bgcolor='#f8f8f8',
    yaxis=dict(title='Minutes'),
    xaxis=dict(title=''),
    margin=dict(
        l=20,
        r=20,
        b=20,
        t=50,
        pad=4
    )
)

fig.update_traces(line_color='#007f00')
fig.show()
```

```{python}
#| label: fig-minutes-month
#| fig-cap: Total of Minutes Played By Year and Month.

fig = px.line(months, x='ts', y='total_mins',)

fig.update_layout(
    title=dict(text='Spotify Played Minutes by Month', font=dict(size=30), yref='paper'),
    template='ggplot2',
    autosize=False,
    width=830,
    height=500,
    showlegend=True,
    plot_bgcolor='#f8f8f8',
    yaxis=dict(title='Minutes'),
    xaxis=dict(title=''),
    margin=dict(
        l=20,
        r=20,
        b=20,
        t=50,
        pad=4
    )
)

fig.update_traces(line_color='#007f00')
fig.show()
```

```{python}
#| column: margin
(
    GT(years)
    .fmt_number(columns='total_mins', decimals=0)
    .cols_label(
        year='Year',
        total_mins='Minutes Played'
    )
    .tab_options(table_font_size='90%')
    .tab_options(table_width='80%')
    .tab_source_note(source_note='Source: Self-elaboration')
)
```

# Top 05 Artists by Year

```{python}
top_artists = (
    df
        .group_by('year','artist_name')
        .agg(pl.len())
        .sort(by=['year','len'], descending=True)
        .select(
            pl.all().top_k_by('len', k=5).over('year')
        )
        .group_by('year')
        .agg(pl.col('artist_name'))
        .sort('year')
)
```

```{python}
#| label: tbl-top-artists
#| tbl-cap: Top 05 Artists by Year.

(
    GT(top_artists)
    .tab_header(title=md("### Top 05 Artist by Year"))
     .cols_width(
        cases={
            'year': '10%',
            'artist_name': '100%',
        }
    )
    .cols_label(
        year='Year',
        artist_name='Artist'
    )
    .cols_align(align='left', columns=('artist_name'))
    .tab_options(table_font_size='90%')
    .tab_options(table_width='90%')
    .tab_source_note(source_note='Source: Self-elaboration by author')
)
```

# Top 05 Albums by Year

```{python}
top_albums = (
    df
        .group_by('year','album_name')
        .agg(pl.len())
        .sort(by=['year','len'], descending=True)
        .select(
            pl.all().top_k_by('len', k=5).over('year')
        )
        .group_by('year')
        .agg(pl.col('album_name'))
        .sort('year')
)
```

```{python}
#| label: tbl-top-albums
#| tbl-cap: Top 05 Albums by Year.

(
    GT(top_albums)
    .tab_header(title=md("### Top 05 Albums by Year"))
     .cols_width(
        cases={
            'year': '10%',
            'album_name': '100%',
        }
    )
    .cols_label(
        year='Year',
        album_name='Album'
    )
    .cols_align(align='left', columns=('album_name'))
    .tab_options(table_font_size='90%')
    .tab_options(table_width='90%')
    .tab_source_note(source_note='Source: Self-elaboration by author')
)
```

# Top 05 Songs by Year

```{python}
top_songs = (
    df
        .group_by('year','track_name')
        .agg(pl.len())
        .sort(by=['year','len'], descending=True)
        .select(
            pl.all().top_k_by('len', k=5).over('year')
        )
        .group_by('year')
        .agg(pl.col('track_name'))
        .sort('year')
)
```

```{python}
#| label: tbl-top-songs
#| tbl-cap: Top 05 Songs by Year.

(
    GT(top_songs)
    .tab_header(title=md("### Top 05 Songs by Year"))
     .cols_width(
        cases={
            'year': '10%',
            'track_name': '100%',
        }
    )
    .cols_label(
        year='Year',
        track_name='Song'
    )
    .cols_align(align='left', columns=('track_name'))
    .tab_options(table_font_size='90%')
    .tab_options(table_width='90%')
    .tab_source_note(source_note='Source: Self-elaboration by author')
)
```

```{python}
platform = (
    df.group_by('platform')
        .agg(pl.len())
        .sort('len', descending=True)
        .with_columns((pl.col("len") / pl.sum("len")).alias("percent"))
)
```

```{python}
#| label: tbl-platform
#| tbl-cap: Total of Records Played by Platform.

(
    GT(platform)
    .tab_header(title=md("### Percentage of Use by Platform"))
    .fmt_number(columns='len', decimals=0)
    .fmt_percent('percent', decimals=2)
    .cols_label(
        platform='Platform',
        len='Total',
        percent='Percentage'
    )
    .cols_align(align='left', columns=('platform'))
    .tab_options(table_font_size='90%')
    .tab_options(table_width='90%')
    .tab_source_note(source_note='Source: Self-elaboration by author')
)
```

# Conclusions

In this analysis, we have shown the following metrics:

- Total mins played by year and month 
- Total unique artists played by year
- Total unique albums played by year
- Total unique songs played by year
- Top 05 artists by year
- Top 05 albums by year
- Top 05 songs by year
- Use by platform

# References

- Maven Analytics (2025). [Maven Music Challenge Dataset](https://mavenanalytics.io/challenges/maven-music-challenge/e161353d-9967-4297-869c-505de168e610). Retrieved from Maven Analytics Website.
- Yonak, R (2019). [How Spotify has changed the way we listen to music](https://audioxide.com/articles/how-spotify-has-changed-the-way-we-listen-to-music). Retrieved from Audioxide Website.

# Appendix

**Data dictionary**

| Field | Description |
| :----- | :----------- |
| spotify_track_uri | Spotify URI that uniquely identifies each track
| ts | Timestamp indicating when the track stopped playing in UTC
| platform | Platform used when streaming the track
| ms_played | Number of milliseconds the stream was played
| track_name | Name of the track
| artist_name | Name of the artist
| album_name | Name of the album
| reason_start | Why the track started
| reason_end | Why the track ended
| shuffle | If shuffle mode was used when playing the track (boolean)
| skipped | If the user skipped to the next song (boolean)

: Data dictionary, detailing field names, and descriptions {#tbl-dictionary .striped .hover .bordered}

# Contact

**Jesus L. Monroy**   
*Economist & Data Scientist*

[Medium](https://medium.com/@jesuslm) |
[Linkedin](https://www.linkedin.com/in/j3sus-lm) |
[Twitter](https://x.com/j3suslm)
